<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase æ•´åˆæ¸¬è©¦ - å»£æ¸…å®®è¨˜å¸³è»Ÿé«”</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus@2.4.0/dist/index.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 32px;
        }
        .test-section {
            margin-bottom: 24px;
            padding: 16px;
            border: 1px solid #e4e7ed;
            border-radius: 6px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #303133;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .status.success {
            background-color: #f0f9ff;
            color: #1e40af;
        }
        .status.error {
            background-color: #fee2e2;
            color: #dc2626;
        }
        .status.pending {
            background-color: #fef3c7;
            color: #92400e;
        }
        .test-result {
            margin-top: 12px;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .controls {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background-color: #409eff;
            color: white;
        }
        .btn-primary:hover {
            background-color: #337ecc;
        }
        .btn-success {
            background-color: #67c23a;
            color: white;
        }
        .btn-success:hover {
            background-color: #529b2e;
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¥ Firebase æ•´åˆæ¸¬è©¦</h1>
            <p>æ¸¬è©¦å»£æ¸…å®®è¨˜å¸³è»Ÿé«”çš„ Firebase é›²ç«¯åŒæ­¥åŠŸèƒ½</p>
        </div>

        <!-- Firebase åˆå§‹åŒ–æ¸¬è©¦ -->
        <div class="test-section">
            <h3>1. Firebase åˆå§‹åŒ– <span id="init-status" class="status pending">æ¸¬è©¦ä¸­...</span></h3>
            <p>æª¢æŸ¥ Firebase é…ç½®å’Œæœå‹™åˆå§‹åŒ–ç‹€æ…‹</p>
            <div id="init-result" class="test-result">ç­‰å¾…æ¸¬è©¦...</div>
        </div>

        <!-- Firestore é€£æ¥æ¸¬è©¦ -->
        <div class="test-section">
            <h3>2. Firestore è³‡æ–™åº«é€£æ¥ <span id="firestore-status" class="status pending">ç­‰å¾…ä¸­...</span></h3>
            <p>æ¸¬è©¦ Firestore è³‡æ–™åº«çš„è®€å¯«åŠŸèƒ½</p>
            <div class="controls">
                <button id="test-firestore" class="btn btn-primary">æ¸¬è©¦ Firestore</button>
                <button id="test-write" class="btn btn-success">æ¸¬è©¦å¯«å…¥</button>
            </div>
            <div id="firestore-result" class="test-result">é»æ“ŠæŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</div>
        </div>

        <!-- èº«ä»½é©—è­‰æ¸¬è©¦ -->
        <div class="test-section">
            <h3>3. èº«ä»½é©—è­‰æœå‹™ <span id="auth-status" class="status pending">ç­‰å¾…ä¸­...</span></h3>
            <p>æ¸¬è©¦ Firebase Authentication åŠŸèƒ½</p>
            <div class="controls">
                <button id="test-auth" class="btn btn-primary">æ¸¬è©¦èº«ä»½é©—è­‰</button>
            </div>
            <div id="auth-result" class="test-result">é»æ“ŠæŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</div>
        </div>

        <!-- é›¢ç·šæ”¯æ´æ¸¬è©¦ -->
        <div class="test-section">
            <h3>4. é›¢ç·šæ”¯æ´ <span id="offline-status" class="status pending">ç­‰å¾…ä¸­...</span></h3>
            <p>æ¸¬è©¦é›¢ç·šæ¨¡å¼å’Œè³‡æ–™åŒæ­¥åŠŸèƒ½</p>
            <div class="controls">
                <button id="test-offline" class="btn btn-primary">æ¸¬è©¦é›¢ç·šåŠŸèƒ½</button>
                <button id="simulate-offline" class="btn btn-success">æ¨¡æ“¬é›¢ç·š</button>
            </div>
            <div id="offline-result" class="test-result">é»æ“ŠæŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</div>
        </div>

        <!-- æ•´é«”æ¸¬è©¦çµæœ -->
        <div class="test-section">
            <h3>ğŸ“Š æ•´é«”æ¸¬è©¦çµæœ</h3>
            <div id="overall-result" class="test-result">
                <div>âœ… é€šéæ¸¬è©¦: <span id="passed-count">0</span></div>
                <div>âŒ å¤±æ•—æ¸¬è©¦: <span id="failed-count">0</span></div>
                <div>â³ å¾…æ¸¬è©¦: <span id="pending-count">4</span></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // å°å…¥ Firebase æ¨¡çµ„
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            getDocs,
            enableNetwork,
            disableNetwork
        } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
        import { 
            getAuth, 
            signInAnonymously,
            onAuthStateChanged 
        } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

        // Firebase é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyCUaCI3_DAs7iYDAUb8ezMqZRnQJJ0511Y",
            authDomain: "temple-accounting-a5d35.firebaseapp.com",
            projectId: "temple-accounting-a5d35",
            storageBucket: "temple-accounting-a5d35.firebasestorage.app",
            messagingSenderId: "1070844356209",
            appId: "1:1070844356209:web:bcc42d152470fd9f5b1dd0",
            measurementId: "G-DD094GW46G"
        };

        // æ¸¬è©¦è¨ˆæ•¸å™¨
        let testResults = {
            passed: 0,
            failed: 0,
            pending: 4
        };

        function updateTestCounts() {
            document.getElementById('passed-count').textContent = testResults.passed;
            document.getElementById('failed-count').textContent = testResults.failed;
            document.getElementById('pending-count').textContent = testResults.pending;
        }

        function setTestStatus(testId, status, message) {
            const statusElement = document.getElementById(`${testId}-status`);
            const resultElement = document.getElementById(`${testId}-result`);
            
            statusElement.className = `status ${status}`;
            statusElement.textContent = status === 'success' ? 'âœ… é€šé' : 
                                      status === 'error' ? 'âŒ å¤±æ•—' : 'â³ æ¸¬è©¦ä¸­';
            
            resultElement.textContent = message;
            
            if (status === 'success') {
                testResults.passed++;
                testResults.pending--;
            } else if (status === 'error') {
                testResults.failed++;
                testResults.pending--;
            }
            
            updateTestCounts();
        }

        // 1. æ¸¬è©¦ Firebase åˆå§‹åŒ–
        async function testFirebaseInit() {
            try {
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                const auth = getAuth(app);
                
                setTestStatus('init', 'success', 
                    `Firebase åˆå§‹åŒ–æˆåŠŸï¼\n` +
                    `App: ${app.name}\n` +
                    `Project ID: ${app.options.projectId}\n` +
                    `Auth Domain: ${app.options.authDomain}`
                );
                
                // å„²å­˜åˆ°å…¨åŸŸè®Šæ•¸ä¾›å…¶ä»–æ¸¬è©¦ä½¿ç”¨
                window.firebaseApp = app;
                window.firebaseDb = db;
                window.firebaseAuth = auth;
                
                return true;
            } catch (error) {
                setTestStatus('init', 'error', `åˆå§‹åŒ–å¤±æ•—: ${error.message}`);
                return false;
            }
        }

        // 2. æ¸¬è©¦ Firestore
        async function testFirestore() {
            try {
                if (!window.firebaseDb) {
                    throw new Error('Firebase æœªåˆå§‹åŒ–');
                }
                
                // æ¸¬è©¦è®€å–
                const testCollection = collection(window.firebaseDb, 'test');
                const snapshot = await getDocs(testCollection);
                
                setTestStatus('firestore', 'success', 
                    `Firestore é€£æ¥æˆåŠŸï¼\n` +
                    `æ¸¬è©¦é›†åˆæ–‡æª”æ•¸é‡: ${snapshot.size}\n` +
                    `é€£æ¥æ™‚é–“: ${new Date().toLocaleTimeString()}`
                );
                
                return true;
            } catch (error) {
                setTestStatus('firestore', 'error', `Firestore æ¸¬è©¦å¤±æ•—: ${error.message}`);
                return false;
            }
        }

        // æ¸¬è©¦å¯«å…¥
        async function testWrite() {
            try {
                if (!window.firebaseDb) {
                    throw new Error('Firebase æœªåˆå§‹åŒ–');
                }
                
                const testData = {
                    message: 'æ¸¬è©¦è¨˜éŒ„',
                    timestamp: new Date(),
                    testId: Math.random().toString(36).substr(2, 9)
                };
                
                const docRef = await addDoc(collection(window.firebaseDb, 'test'), testData);
                
                document.getElementById('firestore-result').textContent = 
                    `å¯«å…¥æ¸¬è©¦æˆåŠŸï¼\n` +
                    `æ–‡æª” ID: ${docRef.id}\n` +
                    `å¯«å…¥æ™‚é–“: ${new Date().toLocaleTimeString()}`;
                
                return true;
            } catch (error) {
                document.getElementById('firestore-result').textContent = 
                    `å¯«å…¥æ¸¬è©¦å¤±æ•—: ${error.message}`;
                return false;
            }
        }

        // 3. æ¸¬è©¦èº«ä»½é©—è­‰
        async function testAuth() {
            try {
                if (!window.firebaseAuth) {
                    throw new Error('Firebase Auth æœªåˆå§‹åŒ–');
                }
                
                // åŒ¿åç™»å…¥æ¸¬è©¦
                const userCredential = await signInAnonymously(window.firebaseAuth);
                const user = userCredential.user;
                
                setTestStatus('auth', 'success', 
                    `èº«ä»½é©—è­‰æˆåŠŸï¼\n` +
                    `ç”¨æˆ¶ ID: ${user.uid}\n` +
                    `åŒ¿åç”¨æˆ¶: ${user.isAnonymous}\n` +
                    `ç™»å…¥æ™‚é–“: ${new Date().toLocaleTimeString()}`
                );
                
                return true;
            } catch (error) {
                setTestStatus('auth', 'error', `èº«ä»½é©—è­‰å¤±æ•—: ${error.message}`);
                return false;
            }
        }

        // 4. æ¸¬è©¦é›¢ç·šåŠŸèƒ½
        async function testOffline() {
            try {
                if (!window.firebaseDb) {
                    throw new Error('Firebase æœªåˆå§‹åŒ–');
                }
                
                // æ¸¬è©¦é›¢ç·šæ”¯æ´
                const isOnline = navigator.onLine;
                
                setTestStatus('offline', 'success', 
                    `é›¢ç·šåŠŸèƒ½æª¢æŸ¥å®Œæˆï¼\n` +
                    `ç•¶å‰ç¶²è·¯ç‹€æ…‹: ${isOnline ? 'åœ¨ç·š' : 'é›¢ç·š'}\n` +
                    `é›¢ç·šå¿«å–: å·²å•Ÿç”¨\n` +
                    `æª¢æŸ¥æ™‚é–“: ${new Date().toLocaleTimeString()}`
                );
                
                return true;
            } catch (error) {
                setTestStatus('offline', 'error', `é›¢ç·šåŠŸèƒ½æ¸¬è©¦å¤±æ•—: ${error.message}`);
                return false;
            }
        }

        // æ¨¡æ“¬é›¢ç·š
        async function simulateOffline() {
            try {
                await disableNetwork(window.firebaseDb);
                document.getElementById('offline-result').textContent = 
                    `å·²æ¨¡æ“¬é›¢ç·šç‹€æ…‹\n` +
                    `Firestore ç¶²è·¯å·²åœç”¨\n` +
                    `æ™‚é–“: ${new Date().toLocaleTimeString()}`;
                
                setTimeout(async () => {
                    await enableNetwork(window.firebaseDb);
                    document.getElementById('offline-result').textContent += 
                        `\n\nå·²æ¢å¾©åœ¨ç·šç‹€æ…‹\n` +
                        `Firestore ç¶²è·¯å·²å•Ÿç”¨\n` +
                        `æ™‚é–“: ${new Date().toLocaleTimeString()}`;
                }, 3000);
                
            } catch (error) {
                document.getElementById('offline-result').textContent = 
                    `é›¢ç·šæ¨¡æ“¬å¤±æ•—: ${error.message}`;
            }
        }

        // ç¶å®šäº‹ä»¶ç›£è½å™¨
        document.addEventListener('DOMContentLoaded', () => {
            // è‡ªå‹•é–‹å§‹ Firebase åˆå§‹åŒ–æ¸¬è©¦
            testFirebaseInit();
            
            // ç¶å®šæŒ‰éˆ•äº‹ä»¶
            document.getElementById('test-firestore').addEventListener('click', testFirestore);
            document.getElementById('test-write').addEventListener('click', testWrite);
            document.getElementById('test-auth').addEventListener('click', testAuth);
            document.getElementById('test-offline').addEventListener('click', testOffline);
            document.getElementById('simulate-offline').addEventListener('click', simulateOffline);
        });
    </script>
</body>
</html>
